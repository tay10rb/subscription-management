# éƒ¨ç½²æŒ‡å—

## æ•°æ®åº“è¿ç§»ç³»ç»Ÿ

æœ¬é¡¹ç›®ç°åœ¨åŒ…å«ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„æ•°æ®åº“è¿ç§»ç³»ç»Ÿï¼Œç¡®ä¿åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬æ—¶æ•°æ®åº“ç»“æ„èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚

### è¿ç§»ç³»ç»Ÿå·¥ä½œåŸç†

1. **è¿ç§»æ–‡ä»¶**: `server/db/migrations.js` åŒ…å«æ‰€æœ‰æ•°æ®åº“è¿ç§»
2. **è¿ç§»è„šæœ¬**: `server/db/migrate.js` æ‰§è¡Œè¿ç§»
3. **å¯åŠ¨è„šæœ¬**: `server/start.sh` åœ¨å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œè¿ç§»
4. **ç‰ˆæœ¬æ§åˆ¶**: ä½¿ç”¨ `migrations` è¡¨è·Ÿè¸ªå·²æ‰§è¡Œçš„è¿ç§»

### æœ¬åœ°å¼€å‘

å¦‚æœæ‚¨åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­éœ€è¦æ‰‹åŠ¨è¿è¡Œè¿ç§»ï¼š

```bash
cd server
node db/migrate.js
```

### Docker éƒ¨ç½²

#### é¦–æ¬¡éƒ¨ç½²

1. ç¡®ä¿æ‚¨æœ‰ `.env` æ–‡ä»¶åŒ…å«å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š
```bash
API_KEY=your_secret_api_key_here
TIANAPI_KEY=your_tianapi_key_here
```

2. æ„å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼š
```bash
docker-compose up -d --build
```

#### æ›´æ–°éƒ¨ç½²

å½“æ‚¨éœ€è¦éƒ¨ç½²åŒ…å«æ•°æ®åº“æ›´æ”¹çš„æ–°ç‰ˆæœ¬æ—¶ï¼š

1. æ‹‰å–æœ€æ–°ä»£ç 
2. é‡æ–°æ„å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼š
```bash
docker-compose down
docker-compose up -d --build
```

å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
- è¿è¡Œæ‰€æœ‰å¾…æ‰§è¡Œçš„è¿ç§»
- å¯åŠ¨åº”ç”¨æœåŠ¡å™¨

#### æ•°æ®æŒä¹…åŒ–

æ•°æ®åº“æ–‡ä»¶å­˜å‚¨åœ¨ Docker volume ä¸­ï¼Œç¡®ä¿æ•°æ®åœ¨å®¹å™¨é‡å¯æ—¶ä¸ä¼šä¸¢å¤±ï¼š
```yaml
volumes:
  - subscription-data:/app/server/db
```

### è¿ç§»ç‰ˆæœ¬å†å²

- **Version 1**: åˆå§‹æ•°æ®åº“ç»“æ„ï¼ˆsubscriptions, settings, exchange_ratesï¼‰
- **Version 2**: æ·»åŠ  categories å’Œ payment_methods è¡¨

### æ•…éšœæ’é™¤

#### è¿ç§»å¤±è´¥

å¦‚æœè¿ç§»å¤±è´¥ï¼Œå®¹å™¨å°†ä¸ä¼šå¯åŠ¨ã€‚æ£€æŸ¥æ—¥å¿—ï¼š
```bash
docker-compose logs subscription-manager
```

#### æ‰‹åŠ¨è¿ç§»

å¦‚æœéœ€è¦æ‰‹åŠ¨è¿è¡Œè¿ç§»ï¼š
```bash
# è¿›å…¥å®¹å™¨
docker-compose exec subscription-manager sh

# è¿è¡Œè¿ç§»
node /app/server/db/migrate.js
```

#### å›æ»šè¿ç§»

ç›®å‰ç³»ç»Ÿä¸æ”¯æŒè‡ªåŠ¨å›æ»šã€‚å¦‚æœéœ€è¦å›æ»šï¼š

1. å¤‡ä»½æ•°æ®åº“
2. æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“ç»“æ„
3. æ›´æ–° migrations è¡¨ä¸­çš„ç‰ˆæœ¬å·

### æ·»åŠ æ–°è¿ç§»

å½“éœ€è¦æ·»åŠ æ–°çš„æ•°æ®åº“æ›´æ”¹æ—¶ï¼š

1. åœ¨ `server/db/migrations.js` ä¸­æ·»åŠ æ–°çš„è¿ç§»ï¼š
```javascript
{
  version: 3,
  name: 'add_new_feature',
  up: () => this.migration_003_add_new_feature()
}
```

2. å®ç°è¿ç§»æ–¹æ³•ï¼š
```javascript
migration_003_add_new_feature() {
  console.log('ğŸ“ Adding new feature...');
  // æ•°æ®åº“æ›´æ”¹ä»£ç 
}
```

3. æµ‹è¯•è¿ç§»
4. éƒ¨ç½²

### å®‰å…¨æ³¨æ„äº‹é¡¹

- å§‹ç»ˆåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰æµ‹è¯•è¿ç§»
- åœ¨é‡è¦æ›´æ–°å‰å¤‡ä»½æ•°æ®åº“
- ç¡®ä¿ API_KEY ç¯å¢ƒå˜é‡å®‰å…¨è®¾ç½®
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…

### ç›‘æ§

å®¹å™¨åŒ…å«å¥åº·æ£€æŸ¥ï¼Œå¯ä»¥ç›‘æ§åº”ç”¨çŠ¶æ€ï¼š
```bash
docker-compose ps
```

æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š
```bash
docker-compose logs -f subscription-manager
```
